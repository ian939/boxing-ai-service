<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë³µì‹± AI ë¶„ì„ ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6 md:p-10">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-blue-500">ğŸ¥Š AI ìŠ¤íŒŒë§ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
            <a href="index.html" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-sm transition-all">
                â† ë‹¤ì‹œ ì—…ë¡œë“œí•˜ê¸°
            </a>
        </div>

        <div class="flex flex-col lg:flex-row gap-10">
            <div class="w-full lg:w-2/3">
                <div class="sticky top-10">
                    <video id="boxingVideo" controls class="w-full rounded-xl shadow-2xl border border-gray-700 bg-black aspect-video">
                        <source id="videoSource" src="" type="video/mp4">
                        ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    </video>
                    
                    <div class="mt-8 p-6 bg-gray-800 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 flex items-center">
                            <span class="mr-2">ğŸ“</span> ë¶„ì„ ì´í‰
                        </h2>
                        <p id="summary" class="text-gray-300 leading-relaxed text-lg">
                            ë°ì´í„°ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                        </p>
                    </div>
                </div>
            </div>

            <div class="w-full lg:w-1/3">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <span class="mr-2">â±ï¸</span> ë¶„ì„ íƒ€ì„ë¼ì¸
                </h2>
                <div id="timeline" class="space-y-4 overflow-y-auto max-h-[800px] pr-2">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // 1. localStorageì—ì„œ ë¶„ì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const rawData = localStorage.getItem('analysisResult');

        if (!rawData) {
            alert("ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—…ë¡œë“œ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
            window.location.href = 'index.html';
        }

        const result = JSON.parse(rawData);
        const reportData = result.report; // AI ë¶„ì„ ë‚´ìš©
        const videoUrl = result.video_url; // ë³€í™˜ëœ ì˜ìƒ URL

        // 2. ì˜ìƒ ì„¤ì •
        const video = document.getElementById('boxingVideo');
        const summaryElement = document.getElementById('summary');
        const timelineContainer = document.getElementById('timeline');

        if (videoUrl) {
            video.src = videoUrl;
            video.load();
        }

        // 3. ì´í‰ ì…ë ¥
        summaryElement.innerText = reportData.summary || "ë¶„ì„ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.";

        // 4. íƒ€ì„ë¼ì¸ ìƒì„±
        if (reportData.feedbacks && reportData.feedbacks.length > 0) {
            reportData.feedbacks.forEach(item => {
                const card = document.createElement('div');
                card.className = "group p-5 bg-gray-800 hover:bg-gray-700 cursor-pointer rounded-xl border-l-4 border-blue-600 transition-all shadow-md active:scale-95";
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-blue-400 font-mono font-bold text-lg">${item.timestamp}</span>
                        <span class="text-xs bg-blue-900 text-blue-200 px-2 py-1 rounded">í´ë¦­ ì‹œ ì´ë™</span>
                    </div>
                    <p class="font-bold text-gray-100 group-hover:text-blue-300 transition-colors">${item.issue}</p>
                    <div class="mt-3 pt-3 border-t border-gray-700">
                        <p class="text-sm text-gray-400 font-medium italic">ğŸ’¡ ì¶”ì²œ ë“œë¦´:</p>
                        <p class="text-sm text-gray-300 mt-1">${item.drill}</p>
                    </div>
                `;
                
                // íƒ€ì„ë¼ì¸ í´ë¦­ ì´ë²¤íŠ¸: í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ì í”„
                card.onclick = () => {
                    const timeParts = item.timestamp.split(':').map(Number);
                    let seconds = 0;
                    
                    if (timeParts.length === 2) { // MM:SS
                        seconds = (timeParts[0] * 60) + timeParts[1];
                    } else if (timeParts.length === 3) { // HH:MM:SS
                        seconds = (timeParts[0] * 3600) + (timeParts[1] * 60) + timeParts[2];
                    }

                    video.currentTime = seconds;
                    video.play();
                    
                    // ëª¨ë°”ì¼ ì‚¬ìš©ìë¥¼ ìœ„í•´ ì˜ìƒ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤ (ì„ íƒ ì‚¬í•­)
                    if (window.innerWidth < 1024) {
                        video.scrollIntoView({ behavior: 'smooth' });
                    }
                };
                
                timelineContainer.appendChild(card);
            });
        } else {
            timelineContainer.innerHTML = "<p class='text-gray-500'>ê²€ì¶œëœ íŠ¹ì´ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        }
    </script>
</body>
</html>
